$(function(){$(".leftColumn").stick_in_parent({offset_top:67,recalc_every:100});$("body").on('click','input.optDate',function(){var wThis=$(this);var wCheckedState=wThis.is(":checked");var wPanelBody=wThis.closest('div.mets-panel-body');var wSelectionGroup=wThis.closest(".mets-field").data("selection-group");wPanelBody.find(".mets-field").each(function(){var wMetsField=$(this);if(wCheckedState&&wMetsField.data("selection-group")==wSelectionGroup){wMetsField.find('select').prop("disabled",false);wMetsField.find('.mets-calendar').datepicker().datepicker('enable');}else{wMetsField.find('select').prop("disabled",true);wMetsField.find('.mets-calendar').datepicker().datepicker('disable');}});});$(".leftColumn").on("click",".mets-panel.toggleable",function(){$(".leftColumn").trigger("sticky_kit:recalc");var panelId=$(this).attr("id");var closestPanelBody=$("#"+panelId+"-body");var filterSection=closestPanelBody.data("filter-section");if($(this).hasClass("collapsed")){$("#sectionKeyExpandedStatus"+filterSection.replace(".","")).val(true);}else{$("#sectionKeyExpandedStatus"+filterSection.replace(".","")).val(false);}});$(".leftColumn").on("click",".filterPanel ul li a",function(e){e.preventDefault();var $this=$(this);var filterItemValue=$this.closest("li").data("filter-item-value");var closestPanelBody=$this.closest(".mets-panel-body");var filterSection=closestPanelBody.data("filter-section");var checkbox=$this.find("input[type=checkbox]");var filterSectionSelected=!checkbox.is(":checked");var parentForm=$this.closest("form");var filterCriterionInput=parentForm.find("input[name='actionFilterCriterion']");filterCriterionInput.val(filterCriterionInput.val()+","+filterSection);var filterValueInput=parentForm.find("input[name='actionFilterValue']");filterValueInput.val(filterValueInput.val()+","+filterItemValue);var filterSelectedInput=parentForm.find("input[name='actionFilterSelected']");filterSelectedInput.val(filterSelectedInput.val()+","+filterSectionSelected);if(!$this.hasClass("preventSubmit")){if(filterSectionSelected){checkbox.prop("checked",true);}else{checkbox.prop("checked",false);}}});$(".leftColumn").on("click",".filterPanel ul li element",function(e){e.preventDefault();var $this=$(this);var filterItemValue=$this.closest("li").data("filter-item-value");var closestPanelBody=$this.closest(".mets-panel-body");var filterSection=closestPanelBody.data("filter-section");var checkbox=$this.find("input[type=checkbox]");var filterSectionSelected=!checkbox.is(":checked");var parentForm=$this.closest("form");var filterCriterionInput=parentForm.find("input[name='actionFilterCriterion']");filterCriterionInput.val(filterCriterionInput.val()+","+filterSection);var filterValueInput=parentForm.find("input[name='actionFilterValue']");filterValueInput.val(filterValueInput.val()+","+filterItemValue);var filterSelectedInput=parentForm.find("input[name='actionFilterSelected']");filterSelectedInput.val(filterSelectedInput.val()+","+filterSectionSelected);if(!$this.hasClass("preventSubmit")){if(filterSectionSelected){checkbox.prop("checked",true);}else{checkbox.prop("checked",false);}}});Rx.Observable.fromEvent($("#myInvitationsClick label.customInput"),"click").debounce(200).subscribe(function(e){executeSearch('Apply Filter');});Rx.Observable.fromEvent($(".leftColumn"),"click").debounce(600).subscribe(function(e){if($("input[name='actionFilterCriterion']").val()!=''){$(".filterPanel").find("ul li a input").prop("disabled",true);$(".filterPanel").find("ul li a").addClass('preventSubmit');executeSearch('Apply Filter');}});$("body").on('keypress','#solicitationSingleBoxSearch',function(e){var wCode=(e.keyCode?e.keyCode:e.which);if(wCode==13){e.preventDefault();executeSearch('Apply Filter');}});$("body").on('click','.statusWrapper .statusRadioButton, #myInvitationsOnly',function(){executeSearch('Apply Filter');});$("body").on('click',"#frmSearch .mets-page-navigation a",function(){prepareFormSubmit();});$(".leftColumn").on('click','#clearIncludedExcludedKeywords',function(){$('#excludedKeywords').val('');executeSearch('Clear Included/Excluded Keywords');});$(".leftColumn").on("click","#publishedDateClearLink",function(){$(this).closest(".mets-panel-body").find("input[type=checkbox]:checked").prop("checked",false);selectDateTypeFilter("publishedDate");var $input=$('<input>').attr('type','hidden').attr('name','publishedDate.dateType').val('');$('#frmSearch').append($input);executeSearch('Clear Filter');});$(".leftColumn").on("click","#closingDateClearLink",function(){$(this).closest(".mets-panel-body").find("input[type=checkbox]:checked").prop("checked",false);selectDateTypeFilter("closingDate");var $input=$('<input>').attr('type','hidden').attr('name','closingDate.dateType').val('');$('#frmSearch').append($input);executeSearch('Clear Filter');});$(".leftColumn").on("click","a.filterClearLink",function(){$(this).closest(".mets-panel-body").find("input.filterHiddenField").val("");executeSearch('Clear Filter');});$("body").on("click","#topSearchButton, #keywordsSearchButton, #publishedDateSearchButton, #closingDateSearchButton",function(e){var $button=$(this);if(!$button.hasClass('disabled')){$('input[name="pageNumber"]').val('1');executeSearch($button.data('awsMetricsAction'));}});$("#content").on("click",".searchContentGroupContainer:not(.secondary-subscriptions)",function(){var $tile=$(this);$(".searchContentGroupContainer").removeClass("selected");$tile.addClass('selected');$("#selectedSearchContentGroupId").val($tile.attr('search-content-group-id'));$('input[name="pageNumber"]').val('1');executeSearch('Content Group Tile');});$(document).on("focusout","#solicitationSingleBoxSearch",function(){$(this).css("height","25px");});$(document).on("focusin","#solicitationSingleBoxSearch",function(){textAreaAdjust(this);});$(document).on("click",".leftColumn .solicitationFilterDate",function(){var innerType=$(this).closest(".customInput").data("inner-type");var searchButton=$("#panel_"+innerType+"-body").find(".dateSearchButton");$(searchButton).data("mets-commandButton").enable();});$(document).on("change",".leftColumn .dateFilter input,.leftColumn .dateFilter select",function(){var searchButton=$(this).closest(".mets-panel-body").find(".dateSearchButton");$(searchButton).data("mets-commandButton").enable();});});function textAreaAdjust(o){o.style.height="1px";o.style.height=(o.scrollHeight)+"px";}
function prepareFormSubmit(){$("#hiddenSingleBoxSearch").val($("#solicitationSingleBoxSearch").val());}
function executeSearch(metricsAction){$("#advancedSearchLightbox").html('');$("#hiddenSingleBoxSearch").val($("#solicitationSingleBoxSearch").val());$('input[name="pageNumber"]').val('1');$("#includedKeywords").val($("#solicitationSingleBoxSearch").val());$.ajax({async:true,data:$('#frmSearch').serialize()+"&metricsSearchActionName="+metricsAction,type:"POST",url:$('#frmSearch').attr("action")});}
function selectedSearchCriterionOnClick(key){$('#breadcrumb').val(key);executeSearch('Clear Filter');}
function filterOrganization(input){$(".leftColumn").find("input[type='checkbox'][name='buyerOrganizationId']").prop("checked",false);input.prop("disabled",false);executeSearch('Apply Filter');}
function findParentCheckbox(chk){return chk.parent().parent().prev().find("input:checkbox");}
function findChildrenCheckboxes(chk){return chk.parent().next('div.sub').find('> div > input:checkbox');}
function showChangeLogsLightbox(solicitation){$.ajax({url:contextPath+"/private/siteadmin/solicitations/search/changelogs",type:'GET',async:true,data:{'solicitationId':solicitation}});}
function pullDownSolicitation(solicitationId){$("#solicitationId").val(solicitationId);$("#target").val("init-pulldown");$("#contactTarget").val("");var wForm=$("#solicitationActionForm");var wData=wForm.serialize();var url=getFormAction(wForm);$.post(url,wData);}
function actAs(solicitationId){$("#solicitationId").val(solicitationId);$("#contactTarget").val("act-as");$("#target").val("");var form=$("#solicitationActionForm");var data=form.serialize();var url=getFormAction(form);$.post(url,data);}
function actAsConfirm(solicitationId){$("#solicitationId").val(solicitationId);$("#contactTarget").val("act-as-confirm");$("#target").val("");var form=$("#solicitationActionForm");var data=form.serialize();var url=getFormAction(form);$.post(url,data);}
function solicitationActions(solicitationId,action){$("#solicitationId").val(solicitationId);$("#contactTarget").val(action);$("#target").val("");var wForm=$("#solicitationActionForm");var wData=wForm.serialize();var url=getFormAction(wForm);$.post(url,wData);}
function submitQuestion(){var wForm=$("#askQuestionForm");var wData=wForm.serialize();var url=getFormAction(wForm);$.post(url,wData);}
function selectDateTypeFilter(criteriaDateName){var wSelectedDateType=$("input[name='"+criteriaDateName+".dateType']:checked").val();var wOffset=parseInt($('#'+criteriaDateName+"_timeZoneOffset").val());if(wSelectedDateType=='DAY'){$('#'+criteriaDateName+"_localDay").datepicker("setDate",getDate(new Date(),wOffset));$('#'+criteriaDateName+"WITHIN")[0].selectedIndex=0;$('#'+criteriaDateName+"_localRangeStart").datepicker("setDate","");$('#'+criteriaDateName+"_localRangeEnd").datepicker("setDate","");$('#'+criteriaDateName+"DAY_hidden").val(dateFormat(new Date(),"yyyy-mm-dd"));$('#'+criteriaDateName+"RANGE1_hidden").val("");$('#'+criteriaDateName+"RANGE2_hidden").val("");}else if(wSelectedDateType=='WITHIN'){$('#'+criteriaDateName+"_localDay").datepicker("setDate","");$('#'+criteriaDateName+"_localRangeStart").datepicker("setDate","");$('#'+criteriaDateName+"_localRangeEnd").datepicker("setDate","");$('#'+criteriaDateName+"DAY_hidden").val("");$('#'+criteriaDateName+"RANGE1_hidden").val("");$('#'+criteriaDateName+"RANGE2_hidden").val("");}else if(wSelectedDateType=='RANGE'){$('#'+criteriaDateName+"_localDay").datepicker("setDate","");$('#'+criteriaDateName+"WITHIN")[0].selectedIndex=0;var wStart=new Date();wStart.setDate(wStart.getDate()-7);$('#'+criteriaDateName+"_localRangeStart").datepicker("setDate",getDate(wStart,wOffset));$('#'+criteriaDateName+"_localRangeEnd").datepicker("setDate",getDate(new Date(),wOffset));$('#'+criteriaDateName+"DAY_hidden").val("");$('#'+criteriaDateName+"RANGE1_hidden").val(dateFormat(wStart,"yyyy-mm-dd"));$('#'+criteriaDateName+"RANGE2_hidden").val(dateFormat(new Date(),"yyyy-mm-dd"));}else{$('#'+criteriaDateName+"_localDay").datepicker("setDate","");$('#'+criteriaDateName+"WITHIN")[0].selectedIndex=0;$('#'+criteriaDateName+"_localRangeStart").datepicker("setDate","");$('#'+criteriaDateName+"_localRangeEnd").datepicker("setDate","");$('#'+criteriaDateName+"DAY_hidden").val("");$('#'+criteriaDateName+"RANGE1_hidden").val("");$('#'+criteriaDateName+"RANGE2_hidden").val("");}
updateDateStatus(criteriaDateName);}
function getDate(date,timeZoneOffsetInMillis){var wUTC=date.getTime()+(date.getTimezoneOffset()*60*1000);return new Date(wUTC+timeZoneOffsetInMillis);}
function validateRequiredAcknowledgementResponse(){if($("#ackResponseAccept").is(':checked')){$.ajax({url:contextPath+$('#saveResponseActionUrl').val()+"/true?target="+$('#targetPage').val(),type:'POST',async:true});}
requiredAcknowledgementDialog.close();}